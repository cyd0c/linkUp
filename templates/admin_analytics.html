{% extends "base.html" %}
{% block content %}
<div class="container-fluid">

  <h2 class="mb-4 fw-bold text-primary">üìä Admin Analytics Dashboard</h2>

  <!-- üîπ User Stats -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <h5 class="text-muted">Total Users</h5>
          <h3 class="fw-bold text-primary">{{ stats.total_users }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <h5 class="text-muted">Students</h5>
          <h3 class="fw-bold text-success">{{ stats.total_students }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <h5 class="text-muted">Clients</h5>
          <h3 class="fw-bold text-info">{{ stats.total_clients }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <h5 class="text-muted">Pending Students</h5>
          <h3 class="fw-bold text-warning">{{ stats.pending_students }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- üîπ All Users -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
      üë• All Users
    </div>
    <div class="card-body table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>Proof</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u.id }}</td>
            <td>{{ u.username }}</td>
            <td>{{ u.email }}</td>
            <td>
              <span class="badge bg-info">{{ u.role }}</span>
            </td>
            <td>
              {% if u.status == "approved" %}
                <span class="badge bg-success">Approved</span>
              {% elif u.status == "pending" %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% else %}
                <span class="badge bg-danger">Rejected</span>
              {% endif %}
            </td>
            <td>
              {% if u.proof_file %}
                <a href="{{ url_for('static', filename=u.proof_file) }}" 
                   target="_blank" class="btn btn-sm btn-outline-primary">View</a>
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              <form method="post" action="{{ url_for('admin.approve_user', user_id=u.id) }}" class="d-inline">
                <button class="btn btn-sm btn-success">Approve</button>
              </form>
              <form method="post" action="{{ url_for('admin.reject_user', user_id=u.id) }}" class="d-inline">
                <button class="btn btn-sm btn-warning">Reject</button>
              </form>
              <form method="post" action="{{ url_for('admin.remove_user', user_id=u.id) }}" 
                    class="d-inline"
                    onsubmit="return confirm('Are you sure you want to completely remove this user?');">
                <button class="btn btn-sm btn-danger">Remove</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="7" class="text-center text-muted">No users found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- üîπ Job & Project Stats -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="text-muted">Jobs</h5>
          <p>Total: <b>{{ stats.total_jobs }}</b></p>
          <p>Open: <span class="text-success">{{ stats.open_jobs }}</span></p>
          <p>Closed: <span class="text-danger">{{ stats.closed_jobs }}</span></p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="text-muted">Projects</h5>
          <p>Total: <b>{{ stats.total_projects }}</b></p>
          <p>Completed: <span class="text-success">{{ stats.completed_projects }}</span></p>
          <p>Verified: <span class="text-primary">{{ stats.verified_projects }}</span></p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="text-muted">Ratings</h5>
          {% if stats.avg_student_rating %}
            <p>‚≠ê <b>{{ "%.1f"|format(stats.avg_student_rating) }}/5</b></p>
          {% else %}
            <p class="text-muted">No ratings yet.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- üîπ All Projects -->
  <div class="card shadow-sm">
    <div class="card-header bg-secondary text-white">
      üìã All Projects
    </div>
    <div class="card-body table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Job</th>
            <th>Student</th>
            <th>Client</th>
            <th>Status</th>
            <th>Verified</th>
            <th>Created</th>
          </tr>
        </thead>
        <tbody>
          {% for p in projects %}
          <tr>
            <td>{{ p.id }}</td>
            <td>{{ p.job.title }}</td>
            <td>{{ p.student.username }}</td>
            <td>{{ p.client.username }}</td>
            <td>
              <span class="badge bg-info">{{ p.status }}</span>
            </td>
            <td>
              {% if p.verified %}
                <span class="badge bg-success">‚úÖ</span>
              {% else %}
                <span class="badge bg-danger">‚ùå</span>
              {% endif %}
            </td>
            <td>{{ p.created_at.strftime('%Y-%m-%d') }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="7" class="text-center text-muted">No projects found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="mt-3">
    <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-secondary">‚¨Ö Back to Admin Dashboard</a>
  </div>

</div>
{% endblock %}
