{% extends "base.html" %}
{% block content %}
<h2>Messages â€“ {{ project.job.title }}</h2>

<!-- Chat history -->
<div class="chat-box border rounded p-3 bg-light">
  {% for msg in messages %}
    <div class="mb-2 d-flex {% if msg.sender_id == current_user.id %}justify-content-end{% else %}justify-content-start{% endif %}">
      <div class="p-2 rounded {% if msg.sender_id == current_user.id %}bg-success text-white{% else %}bg-white border{% endif %}" style="max-width:70%;">
        <b>{{ 'You' if msg.sender_id == current_user.id else msg.sender.username }}</b><br>
        {{ msg.message_text|safe }}
        <div class="small text-muted">{{ msg.timestamp.strftime('%Y-%m-%d %H:%M') }}</div>
      </div>
    </div>
  {% else %}
    <p>No messages yet.</p>
  {% endfor %}
</div>

<!-- Send a new message -->
<form method="post" class="mt-3">
  <div class="input-group">
    <textarea name="message_text" class="form-control" placeholder="Type a message..."></textarea>
    <button class="btn btn-primary">Send</button>
  </div>
</form>

<!-- Approve button (client only, when project is submitted) -->
{% if current_user.id == project.client_id and project.status == "submitted" %}
<form method="post" class="mt-3">
  <input type="hidden" name="approve_project" value="1">
  <button class="btn btn-success">âœ… Approve Project & Send Code</button>
</form>
{% elif current_user.role == "Student" %}
<a href="{{ url_for('student.submit_code') }}" class="btn btn-outline-success mt-3">
  ðŸ”‘ Submit Approval Code
</a>

{% endif %}

{% endblock %}
