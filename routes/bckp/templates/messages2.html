{% extends "base.html" %}
{% block content %}
<h2>Chat for {{ project.job.title }}</h2>

<style>
  .chat-box {
    border: 1px solid #ccc;
    padding: 10px;
    max-height: 400px;
    overflow-y: auto;
    background: #f9f9f9;
  }
  .message {
    margin: 5px 0;
    padding: 8px 12px;
    border-radius: 12px;
    display: inline-block;
    max-width: 70%;
    clear: both;
  }
  .me {
    background: #d1ffd1;
    float: right;
    text-align: right;
  }
  .other {
    background: #fff;
    float: left;
    text-align: left;
  }
  .timestamp {
    display: block;
    font-size: 0.7em;
    color: #666;
    margin-top: 2px;
  }
  .chat-form {
    margin-top: 15px;
  }
</style>

<<h2>Chat – {{ project.job.title }}</h2>
<div class="chat-box border rounded p-3 bg-light">
  {% for msg in messages %}
    <div class="mb-2 d-flex {% if msg.sender_id == current_user.id %}justify-content-end{% else %}justify-content-start{% endif %}">
      <div class="p-2 rounded {% if msg.sender_id == current_user.id %}bg-success text-white{% else %}bg-white border{% endif %}" style="max-width:70%;">
        <b>{{ 'You' if msg.sender_id == current_user.id else msg.sender.username }}</b><br>
        {{ msg.message_text }}
        <div class="small text-muted">{{ msg.timestamp.strftime('%Y-%m-%d %H:%M') }}</div>
      </div>
    </div>
  {% else %}
    <p>No messages yet.</p>
  {% endfor %}
</div>

<form method="post" class="mt-3">
  <div class="input-group">
    <textarea name="message_text" class="form-control" placeholder="Type a message..."></textarea>
    <button class="btn btn-primary">Send</button>
  </div>
</form>

<a href="{{ url_for('dashboard') }}">⬅ Back to Dashboard</a>
{% endblock %}
