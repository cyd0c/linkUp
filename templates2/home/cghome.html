{% extends 'layouts/base.html' %}

{% block title %} Caregiver Dashboard {% endblock title %}

{% block stylesheets %}
<style>
    body {
        background-image: url("/static/images/cgbg.jpg");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        color: white;
    }

    .content-wrapper {
        background: rgba(0, 0, 0, 0.6);
        padding: 30px;
        border-radius: 15px;
        color: white;
    }

    .enhanced-header {
        background: rgba(0, 123, 255, 0.8);
        color: white;
        text-align: center;
        padding: 40px 20px;
        border-radius: 15px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        margin-bottom: 30px;
        font-size: 1.2rem;
    }
    .enhanced-header h2 {
        font-size: 2.5rem;
        font-weight: bold;
    }
    .enhanced-header p {
        font-size: 1.2rem;
        margin-top: 10px;
    }

    .card-custom {
        border-radius: 15px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
        padding: 20px;
        color: #333;
        transition: all 0.3s ease-in-out;
    }
    .card-custom:hover {
        transform: translateY(-5px);
        box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.3);
    }
    .card-title {
        font-size: 20px;
        font-weight: bold;
        color: #007bff;
    }

    .quote-box {
        font-size: 16px;
        font-style: italic;
        text-align: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        margin-top: 15px;
        color: #333;
        font-weight: bold;
        transition: opacity 0.5s ease-in-out;
    }

    .news-container {
        margin-top: 20px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
    }
    .news-container ul {
        list-style-type: none;
        padding-left: 0;
    }
    .news-container li {
        margin-bottom: 8px;
        font-size: 16px;
    }
    .news-container a {
        text-decoration: none;
        color: #007bff;
        font-weight: bold;
        transition: 0.3s;
    }
    .news-container a:hover {
        text-decoration: underline;
    }

    .notification {
        z-index: 1000;
        position: relative;
        margin-bottom: 20px;
    }
    #notification-box {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    .badge-danger {
        background-color: red;
        color: white;
        font-size: 0.75rem;
        padding: 4px 7px;
        border-radius: 50%;
    }

    /* Chatbot Styling */
    .chatbot-container {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 320px;
        background: white;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        display: none;
        flex-direction: column;
        font-family: Arial, sans-serif;
    }
    .chat-header {
        background: #007bff;
        color: white;
        padding: 10px;
        border-radius: 10px 10px 0 0;
        font-weight: bold;
    }
    .chat-body {
        max-height: 300px;
        overflow-y: auto;
        padding: 10px;
        display: flex;
        flex-direction: column;
    }
    .chat-footer {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ddd;
    }
    .chat-footer input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    .chat-footer button {
        margin-left: 5px;
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
    }
    .chat-message {
        max-width: 80%;
        padding: 8px;
        border-radius: 8px;
        margin-bottom: 5px;
    }
    .bot-message {
        align-self: flex-start;
        background: #f1f1f1;
        color: #333;
    }
    .user-message {
        align-self: flex-end;
        background: #007bff;
        color: white;
    }
    .chatbot-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #007bff;
        color: white;
        padding: 10px 15px;
        border-radius: 50px;
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    
</style>
{% endblock stylesheets %}

{% block content %}
<!-- Header -->
<div class="header enhanced-header">
    <h2>Welcome, {{ caregiver.username }}!</h2>
    <p>We're glad to have you on SilverSupport.</p>
    <div class="container mt-3 d-flex justify-content-end">
        <!-- Notification Icon -->
        <div style="position: relative; cursor: pointer;" onclick="toggleNotifications()">
            <i class="fas fa-bell fa-2x text-white"></i>
            <span id="notification-count" class="badge badge-danger" style="position: absolute; top: -5px; right: -10px;">
                {{ get_flashed_messages(with_categories=true)|length }}
            </span>
        </div>
    
        <!-- Reviews Icon -->
        <div style="position: relative; cursor: pointer; margin-left: 20px;" onclick="window.location='{{ url_for('caregiver_reviews') }}'">
            <i class="fas fa-clipboard-list fa-2x text-white"></i>
            <span class="badge badge-danger" style="position: absolute; top: -5px; right: -10px;">📋</span>
        </div>
    </div>
    
</div>


<!-- Notifications -->
<div id="notification-box" class="notification container mt-2" style="display: none;">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
   
</div>


<!-- Main Content -->
<div class="container-fluid mt-4 content-wrapper">
    <div class="row">
        <div class="col-lg-8">
            <div class="card card-custom">
                <h5 class="card-title">🌟 Welcome to SilverSupport</h5>
                <p>
                    SilverSupport is an innovative platform connecting families with trusted caregivers for elderly individuals.
                    Our goal is to provide compassionate and reliable elderly care by matching families with experienced caregivers.
                </p>
                <div class="quote-box" id="quote-box">
                    <p id="quote-text"></p>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card card-custom text-center">
                <h5 class="card-title">📞 Contact Us</h5>
                <p><strong>Email:</strong> sandrasanthosh202002@gmail.com</p>
                <p><strong>Phone:</strong> 123-456-7890</p>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="news-container">
                <h3>📢 Latest Elderly Care News</h3>
                <ul id="news-feed"></ul>
            </div>
        </div>
    </div>
</div>

<!-- Chatbot -->
<div class="chatbot-container" id="chatbot">
    <div class="chat-header">
        <strong>🩺 Health Assistant</strong>
        <span style="float: right; cursor: pointer;" onclick="toggleChatbot()">✖</span>
    </div>
    <div class="chat-body" id="chat-body">
        <div class="chat-message bot-message">Hello! I'm your Health Assistant. How can I help you today? 😊</div>
    </div>
    <div class="chat-footer">
        <input type="text" id="chat-input" placeholder="Ask me about health & caregiving..." onkeypress="handleKeyPress(event)">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>
<div class="chatbot-button" id="chatbot-button" onclick="toggleChatbot()">💬 Chat</div>

<!-- Scripts -->
<script>
    async function fetchNews() {
        try {
            const response = await fetch("https://newsapi.org/v2/everything?q=elderly%20care&apiKey=a65d5ac0a2f9411681c267413e0b448c");
            const data = await response.json();
            const newsFeed = document.getElementById("news-feed");
            newsFeed.innerHTML = "";
            data.articles.slice(0, 5).forEach(article => {
                let listItem = document.createElement("li");
                listItem.innerHTML = `<a href="${article.url}" target="_blank">📰 ${article.title}</a>`;
                newsFeed.appendChild(listItem);
            });
        } catch (error) {
            console.error("Error fetching news:", error);
        }
    }
    setInterval(fetchNews, 60000);
    fetchNews();

    const quotes = [
        "Caregiving often calls us to lean into love we didn’t know possible. – Tia Walker",
        "To care for those who once cared for us is one of the highest honors. – Tia Walker",
        "You are not alone in this journey, keep going! 💙",
        "Compassion brings us closer and makes the world better. ✨",
        "Caring for others is the ultimate sign of strength. 💪"
    ];

    function showRandomQuote() {
        const quoteText = document.getElementById("quote-text");
        quoteText.innerText = quotes[Math.floor(Math.random() * quotes.length)];
        const quoteBox = document.getElementById("quote-box");
        quoteBox.style.opacity = 0;
        setTimeout(() => {
            quoteBox.style.opacity = 1;
        }, 300);
    }
    setInterval(showRandomQuote, 10000);
    showRandomQuote();

    function toggleChatbot() {
        const chatbot = document.getElementById("chatbot");
        const button = document.getElementById("chatbot-button");
        chatbot.style.display = chatbot.style.display === "none" || chatbot.style.display === "" ? "flex" : "none";
        button.innerHTML = chatbot.style.display === "flex" ? "✖ Close" : "💬 Chat";
    }

    function handleKeyPress(event) {
        if (event.key === "Enter") sendMessage();
    }

    function sendMessage() {
        const inputField = document.getElementById("chat-input");
        const chatBody = document.getElementById("chat-body");
        const userMessage = inputField.value.trim();
        if (userMessage === "") return;
        addChatMessage(userMessage, "user-message");
        setTimeout(() => addChatMessage(getBotResponse(userMessage), "bot-message"), 1000);
        inputField.value = "";
    }

    function addChatMessage(message, className) {
        const chatBody = document.getElementById("chat-body");
        const messageElement = document.createElement("div");
        messageElement.className = "chat-message " + className;
        messageElement.innerText = message;
        chatBody.appendChild(messageElement);
        chatBody.scrollTop = chatBody.scrollHeight;
    }

    function getBotResponse(message) {
    const msg = message.toLowerCase();

    // General Information
    if (msg.includes("how do i sign up") && msg.includes("caregiver")) {
        return "Go to “Sign Up,” select “Caregiver,” and complete the form with your experience and certifications.";
    } else if (msg.includes("requirements") && msg.includes("caregiver")) {
        return "Basic experience in caregiving and a background check are required.";
    } else if (msg.includes("fee") && msg.includes("join")) {
        return "No, joining as a caregiver is free.";

    // Profile Management
    } else if (msg.includes("update my profile") || msg.includes("edit profile")) {
        return "Login and go to “My Profile” to edit or update information.";
    } else if (msg.includes("add certifications") || msg.includes("skills to my profile")) {
        return "Yes, you can upload documents and list your skills in the profile section.";
    }

    // Payments and Earnings
    else if (msg.includes("get paid") || msg.includes("receive payment")) {
        return "Payments are made through the platform and transferred to your linked account.";
    } else if (msg.includes("payment schedule")) {
        return "Payments are usually processed weekly after session completion.";
    } else if (msg.includes("fees deducted") || msg.includes("service fee")) {
        return "A small platform service fee may be deducted; it will be clearly stated.";

    // Communication
    } else if (msg.includes("message families") || msg.includes("talk to families")) {
        return "Use the in-platform messaging feature to chat with families.";
    } else if (msg.includes("interview") && msg.includes("families")) {
        return "Yes, families may request an interview via the platform.";
    }

    // Safety and Trust
    else if (msg.includes("safety") && msg.includes("caregiver")) {
        return "We screen families and offer reporting tools and support to address concerns.";
    } else if (msg.includes("unsafe") || msg.includes("feel unsafe")) {
        return "Leave the situation if needed and report it to the platform immediately.";

    // Reviews and Feedback
    } else if (msg.includes("see reviews")) {
        return "Yes, feedback from families will appear on your profile.";
    } else if (msg.includes("negative review")) {
        return "One review won’t affect you drastically, but you can reach out for mediation.";

    // Support and Help
    } else if (msg.includes("support") || msg.includes("help available")) {
        return "Yes, 24/7 chat and email support are available.";
    } else if (msg.includes("report issue")) {
        return "Use the in-app reporting tool or contact support directly.";

    // Resources and Skills
    } else if (msg.includes("resources") || msg.includes("training materials")) {
        return "We offer access to training videos and articles through the caregiver dashboard.";
    } else if (msg.includes("training") && msg.includes("available")) {
        return "Yes, you can access caregiving tips, courses, and health care guides.";

    // Scheduling and Availability
    } else if (msg.includes("part-time") || msg.includes("weekends only")) {
        return "Yes, you can set your availability to fit your schedule.";
    } else if (msg.includes("cancel job") || msg.includes("emergency")) {
        return "Notify the family and platform as early as possible through the system.";

    // Fallback
    } else {
        return "I'm not sure about that. Try asking about caregiver signup, payments, profiles, or training.";
    }
}

    function toggleNotifications() {
        const box = document.getElementById("notification-box");
        box.style.display = box.style.display === "none" ? "block" : "none";
    }
</script>
{% endblock content %}  